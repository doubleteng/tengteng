<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Publications | Teng Teng</title>
<meta name="description" content="Publications by Teng Teng: journals, conferences, books, theses, and patents.">
<style>
  :root{--bg:#fff;--text:#111827;--sub:#6b7280;--border:#e5e7eb;--shadow:0 8px 24px rgba(0,0,0,.06);--radius:18px;--chip:#f3f4f6}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Noto Sans,sans-serif;background:var(--bg);color:var(--text);line-height:1.6}
  a{color:var(--text);text-decoration:none} a:hover{text-decoration:underline}
  .wrap{max-width:1080px;margin:0 auto;padding:24px}

  /* Nav */
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 0 8px;position:sticky;top:0;background:rgba(255,255,255,.88);backdrop-filter:blur(8px);z-index:10;border-bottom:1px solid var(--border)}
  .brand{display:flex;align-items:center;gap:12px;font-weight:800}
  .brand .logo{width:36px;height:36px;border-radius:12px;background:#111827;color:#fff;display:grid;place-items:center;box-shadow:0 6px 18px rgba(0,0,0,.08)}
  nav.menu>ul{list-style:none;margin:0;padding:0;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  nav.menu>ul>li>a{color:var(--sub);font-weight:600;display:inline-block;padding:6px 10px;border-radius:8px}
  nav.menu>ul>li>a:hover{color:var(--text);background:#f3f4f6}

  h1{font-size:clamp(26px,3.6vw,40px);margin:14px 0 8px}
  .sub{color:var(--sub)}

  /* Filters */
  .toolbar{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:12px 0 14px;flex-wrap:wrap}
  .types{display:flex;gap:8px;flex-wrap:wrap}
  .btn{border:1px solid var(--border);border-radius:12px;padding:8px 12px;background:#fff;font-weight:700}
  .btn[aria-pressed="true"]{background:var(--chip)}
  .count{color:var(--sub);font-size:14px}

  /* Year sections + items */
  .year{margin:18px 0 8px;font-size:20px}
  .list{display:grid;gap:12px;margin-top:6px}
  .item{background:#fff;border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);padding:14px}
  .title{font-weight:800;margin:0 0 6px;font-size:16px}
  .meta{color:var(--sub);font-size:14px;margin:0 0 8px}
  .badges{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:8px 0 0}
  .badge{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid var(--border);font-size:12px;background:#fff}
  .links{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
  .links a{display:inline-block;padding:6px 10px;border:1px solid var(--border);border-radius:10px;background:#fff}
  .empty{color:var(--sub);border:1px dashed var(--border);border-radius:12px;padding:16px;text-align:center}

  footer{color:var(--sub);font-size:13px;text-align:center;padding:28px 0 12px;margin-top:24px}
</style>
</head>
<body>
<div class="wrap">
  <!-- Header & Nav -->
  <header>
    <div class="brand"><div class="logo">TT</div><span>Teng Teng</span></div>
    <nav class="menu" aria-label="Primary">
      <ul>
        <li><a href="../">Home</a></li>
        <li><a href="../research/">Research</a></li>
        <li><a href="../teaching/">Teaching</a></li>
        <li><a href="../design/">Design</a></li>
        <li><a href="./">Publications</a></li>
        <li><a href="../news/">News</a></li>
        <li><a href="../about/">About</a></li>
        <li><a href="../contact/">Contact</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <h1>Publications</h1>
    <div class="sub">Peer-reviewed articles, conference papers, book chapters, theses, and patents.</div>

    <div class="toolbar">
      <div class="types" role="tablist" aria-label="Type filter">
        <button class="btn" data-type="all" aria-pressed="true">All</button>
        <button class="btn" data-type="journal" aria-pressed="false">Journal</button>
        <button class="btn" data-type="conference" aria-pressed="false">Conference</button>
        <button class="btn" data-type="book" aria-pressed="false">Book</button>
        <button class="btn" data-type="thesis" aria-pressed="false">Thesis</button>
        <button class="btn" data-type="patent" aria-pressed="false">Patent</button>
        <button class="btn" data-type="inreview" aria-pressed="false">In Review</button>
      </div>
      <div class="count" id="count"></div>
    </div>

    <div id="container"></div>
  </main>

  <footer>© <span id="year"></span> Teng Teng</footer>
</div>

<!-- 数据源（与你的 projects.js 用法一致） -->
<script src="../assets/js/pubs.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function(){
  const y=document.getElementById('year'); if(y) y.textContent=new Date().getFullYear();

  const data = (window.PUBS || []).slice();
  const container = document.getElementById('container');
  const count = document.getElementById('count');
  const buttons = Array.from(document.querySelectorAll('[data-type]'));

  const LABEL = {
    journal: 'Journal',
    conference: 'Conference',
    book: 'Book',
    thesis: 'Thesis',
    patent: 'Patent',
    inreview: 'In Review'
  };

  // 允许 ?type=journal 预选
  let activeType = getTypeFromQuery() || 'all';
  setPressed(buttons.find(b => b.dataset.type === activeType));

  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      setPressed(btn);
      activeType = btn.dataset.type;
      const url = new URL(location.href);
      url.searchParams.set('type', activeType);
      history.replaceState(null,'',url.toString());
      render();
    });
  });

  function getTypeFromQuery(){
    const p=new URLSearchParams(location.search).get('type');
    return (['all','journal','conference','book','thesis','patent','inreview'].includes(p||'')) ? p : null;
  }
  function setPressed(target){ buttons.forEach(b=>b.setAttribute('aria-pressed', String(b===target))); }

  function byYearDesc(a,b){ return (b.year||0)-(a.year||0); }

  function boldMe(authors){
    if(!authors) return '';
    // Bold both "Teng, Teng" and "Teng Teng" (case-insensitive, keep punctuation)
    return authors
      .replace(/Teng,\s*Teng/gi, '<strong>Teng, Teng</strong>')
      .replace(/\bTeng\s+Teng\b/gi, '<strong>Teng Teng</strong>');
  }

  function resolveUrl(u){
    if(!u) return null;
    if(/^https?:\/\//i.test(u)) return u;   // external
    return '../' + u.replace(/^\/+/,'');    // internal relative to /publications/
  }

  function bestTitleLink(rec){
    // 优先 DOI 作为标题链接，其次 link（内外链均可），否则纯文本
    if(rec.doi) return {href: rec.doi, label: rec.title};
    if(rec.link) return {href: resolveUrl(rec.link), label: rec.title};
    return {href: null, label: rec.title};
  }

  function item(rec){
    const tlink = bestTitleLink(rec);
    const venue = rec.venue ? rec.venue : '';
    const note  = rec.note ? ` · ${rec.note}` : '';
    const typeBadge = `<span class="badge">${LABEL[rec.type] || rec.type}</span>`;

    const links = [];
    if(rec.doi) links.push(`<a href="${rec.doi}" target="_blank" rel="noopener">DOI</a>`);
    if(rec.pdf) links.push(`<a href="${resolveUrl(rec.pdf)}" target="_blank" rel="noopener">PDF</a>`);
    if(rec.link){
      const isExternal = /^https?:\/\//i.test(rec.link);
      links.push(`<a href="${resolveUrl(rec.link)}" ${isExternal?'target="_blank" rel="noopener"':''}>${isExternal?'Link':'Project'}</a>`);
    }

    return `
      <article class="item">
        <h3 class="title">${tlink.href ? `<a href="${tlink.href}" target="_blank" rel="noopener">${tlink.label}</a>` : tlink.label}</h3>
        <p class="meta">${boldMe(rec.authors)} — <em>${venue}</em>${note}</p>
        <div class="badges">${typeBadge}${links.length? `<div class="links">${links.join('')}</div>` : ''}</div>
      </article>
    `;
  }

  function groupByYear(list){
    const map = new Map();
    list.forEach(r=>{
      const y = r.year || 0;
      if(!map.has(y)) map.set(y, []);
      map.get(y).push(r);
    });
    return Array.from(map.entries()).sort((a,b)=>b[0]-a[0]); // year desc
  }

  function render(){
    let list = data.slice();
    if(activeType !== 'all'){
      list = list.filter(r => (r.type||'').toLowerCase() === activeType);
    }
    list.sort(byYearDesc);

    if(!list.length){
      container.innerHTML = `<div class="empty">No publications found for this filter.</div>`;
      count.textContent = '0 items';
      return;
    }

    const sections = groupByYear(list).map(([yr, items])=>{
      const section = items.map(item).join('');
      return `<h2 class="year">${yr}</h2><div class="list">${section}</div>`;
    }).join('');

    container.innerHTML = sections;
    count.textContent = `${list.length} item${list.length>1?'s':''}`;
  }

  render();
});
</script>
</body>
</html>
