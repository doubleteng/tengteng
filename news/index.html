<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>News | Teng Teng</title>
<meta name="description" content="News and updates from Teng Teng and the lab.">
<style>
  :root{--bg:#fff;--text:#111827;--sub:#6b7280;--border:#e5e7eb;--shadow:0 8px 24px rgba(0,0,0,.06);--chip:#f3f4f6;--radius:18px}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Noto Sans,sans-serif;background:var(--bg);color:var(--text);line-height:1.6}
  a{color:var(--text);text-decoration:none}
  a:hover{text-decoration:underline}
  .wrap{max-width:1080px;margin:0 auto;padding:24px}

  /* Nav */
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 0 8px;position:sticky;top:0;background:rgba(255,255,255,.88);backdrop-filter:blur(8px);z-index:10;border-bottom:1px solid var(--border)}
  .brand{display:flex;align-items:center;gap:12px;font-weight:800}
  .brand .logo{width:36px;height:36px;border-radius:12px;background:#111827;color:#fff;display:grid;place-items:center;box-shadow:0 6px 18px rgba(0,0,0,.08)}
  nav.menu>ul{list-style:none;margin:0;padding:0;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  nav.menu>ul>li>a{color:var(--sub);font-weight:600;display:inline-block;padding:6px 10px;border-radius:8px}
  nav.menu>ul>li>a:hover{color:var(--text);background:#f3f4f6}

  h1{font-size:clamp(26px,3.6vw,40px);margin:14px 0 8px}
  .sub{color:var(--sub)}

  /* Toolbar */
  .toolbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:12px 0 16px;flex-wrap:wrap}
  .cats,.tags{display:flex;gap:8px;flex-wrap:wrap}
  .btn{border:1px solid var(--border);border-radius:12px;padding:8px 12px;background:#fff;font-weight:700}
  .btn[aria-pressed="true"]{background:var(--chip)}
  .chip{border:1px solid var(--border);border-radius:999px;padding:6px 10px;background:#fff;font-weight:700;font-size:13px}
  .chip[aria-pressed="true"]{background:var(--chip)}
  .count{color:var(--sub);font-size:14px}

  /* Layout */
  .section-title{margin:18px 0 8px;font-size:20px}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
  @media(max-width:1000px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media(max-width:640px){.grid{grid-template-columns:1fr}}

  .card{background:#fff;border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);display:flex;flex-direction:column;overflow:hidden}
  .cover{aspect-ratio:16/9;background:#f5f5f5 url('') center/cover;border-bottom:1px solid var(--border)}
  .content{padding:14px}
  .title{font-weight:800;margin:0 0 6px;font-size:16px}
  .meta{color:var(--sub);font-size:13px;margin:0 0 8px}
  .excerpt{margin:0 0 8px}
  .badge{display:inline-block;padding:3px 8px;border:1px solid var(--border);border-radius:999px;font-size:12px;background:#fff;margin-right:6px}
  .tag{display:inline-block;padding:3px 8px;border:1px dashed var(--border);border-radius:999px;font-size:12px;color:#4b5563;margin:2px 6px 0 0}
  .footer{padding:12px 14px;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
  .linkbtn{border:1px solid var(--border);border-radius:10px;padding:6px 10px;background:#fff;font-weight:700}

  .empty{color:var(--sub);border:1px dashed var(--border);border-radius:12px;padding:16px;text-align:center;margin:16px 0}
  footer{color:var(--sub);font-size:13px;text-align:center;padding:28px 0 12px;margin-top:24px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand"><div class="logo">TT</div><span>Teng Teng</span></div>
    <nav class="menu" aria-label="Primary">
      <ul>
        <li><a href="../">Home</a></li>
        <li><a href="../research/">Research</a></li>
        <li><a href="../teaching/">Teaching</a></li>
        <li><a href="../design/">Design</a></li>
        <li><a href="../publications/">Publications</a></li>
        <li><a href="./">News</a></li>
        <li><a href="../about/">About</a></li>
        <li><a href="../contact/">Contact</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <h1>News</h1>
    <div class="sub">Announcements, talks, publications, awards, workshops, hiring, and project updates.</div>

    <div class="toolbar">
      <div class="cats" role="tablist" aria-label="Category filter">
        <button class="btn" data-cat="all" aria-pressed="true">All</button>
        <button class="btn" data-cat="research" aria-pressed="false">Research</button>
        <button class="btn" data-cat="teaching" aria-pressed="false">Teaching</button>
        <button class="btn" data-cat="design" aria-pressed="false">Design</button>
        <button class="btn" data-cat="lab" aria-pressed="false">Lab</button>
      </div>
      <div class="count" id="count"></div>
    </div>

    <!-- Tags toolbar (single select; auto-populated) -->
    <div class="tags" id="tagsbar" aria-label="Tag filter"></div>

    <!-- Pinned -->
    <section id="pinnedSection" style="display:none">
      <h2 class="section-title">Pinned</h2>
      <div class="grid" id="pinnedGrid"></div>
    </section>

    <!-- Timeline by year -->
    <div id="timeline"></div>

    <div id="empty" class="empty" style="display:none">No news found for this filter.</div>
  </main>

  <footer>Â© <span id="year"></span> Teng Teng</footer>
</div>

<!-- Data source -->
<script src="../assets/js/news.js"></script>
<script>
document.getElementById('year').textContent=new Date().getFullYear();

(function(){
  const raw = Array.isArray(window.NEWS) ? window.NEWS.slice() : [];

  const container = document.getElementById('timeline');
  const pinnedGrid = document.getElementById('pinnedGrid');
  const pinnedSection = document.getElementById('pinnedSection');
  const tagsbar = document.getElementById('tagsbar');
  const count = document.getElementById('count');
  const catBtns = Array.from(document.querySelectorAll('[data-cat]'));
  const urlParams = new URLSearchParams(location.search);

  const CAT_LABEL = {research:'Research', teaching:'Teaching', design:'Design', lab:'Lab'};
  const DATE_FORMAT = { year:'numeric', month:'short', day:'2-digit' };

  // URL preselect: ?cat=research&tag=award
  let activeCat = (urlParams.get('cat')||'all').toLowerCase();
  if(!['all','research','teaching','design','lab'].includes(activeCat)) activeCat='all';
  setPressed(catBtns.find(b=>b.dataset.cat===activeCat));

  let activeTag = (urlParams.get('tag')||'').toLowerCase() || null;

  // Build unique tag list
  const allTags = Array.from(new Set(raw.flatMap(n => Array.isArray(n.tags)? n.tags.map(t=>t.toLowerCase()): []))).sort();
  renderTags();

  // Wire category buttons
  catBtns.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      setPressed(btn);
      activeCat = btn.dataset.cat;
      updateQuery();
      render();
    });
  });

  function setPressed(target){ catBtns.forEach(b=>b.setAttribute('aria-pressed', String(b===target))); }

  function updateQuery(){
    const u = new URL(location.href);
    u.searchParams.set('cat', activeCat);
    if(activeTag) u.searchParams.set('tag', activeTag); else u.searchParams.delete('tag');
    history.replaceState(null,'',u.toString());
  }

  function renderTags(){
    if(allTags.length===0){ tagsbar.style.display='none'; return; }
    tagsbar.style.display='flex';
    tagsbar.innerHTML = [
      `<button class="chip" data-tag="" aria-pressed="${!activeTag}">All tags</button>`,
      ...allTags.map(t=>`<button class="chip" data-tag="${t}" aria-pressed="${activeTag===t}">${t}</button>`)
    ].join('');
    tagsbar.querySelectorAll('[data-tag]').forEach(chip=>{
      chip.addEventListener('click',()=>{
        const t = chip.getAttribute('data-tag');
        activeTag = t || null; // single-select
        updateQuery();
        renderTags(); // refresh pressed state
        render();
      });
    });
  }

  function parseDate(s){
    // s: 'YYYY-MM-DD'
    const [y,m,d] = (s||'').split('-').map(v=>parseInt(v,10));
    if(!y) return new Date(0);
    return new Date(y, (m||1)-1, d||1);
  }

  function resolveLink(href){
    if(!href) return null;
    if(/^https?:\/\//i.test(href)) return href;
    return '../' + href.replace(/^\/+/,'');
  }

  function badge(cat){
    const label = CAT_LABEL[cat] || 'News';
    return `<span class="badge">${label}</span>`;
  }

  function card(n){
    const date = parseDate(n.date);
    const dateStr = isNaN(date) ? (n.date||'') : date.toLocaleDateString(undefined, DATE_FORMAT);
    const link = resolveLink(n.link);
    const tags = Array.isArray(n.tags)? n.tags.map(t=>`<span class="tag">#${t}</span>`).join('') : '';
    const imgStyle = n.image ? `style="background-image:url('${n.image}');"` : '';
    const titleHTML = link ? `<a href="${link}" ${/^https?:\/\//i.test(link)?'target="_blank" rel="noopener"':''}>${n.title}</a>` : n.title;

    return `
      <article class="card">
        <div class="cover" ${imgStyle} aria-label="Cover image"></div>
        <div class="content">
          <h3 class="title">${titleHTML}</h3>
          <p class="meta">${badge(n.category)} Â· ${dateStr}</p>
          <p class="excerpt">${n.excerpt||''}</p>
          <div>${tags}</div>
        </div>
        <div class="footer">
          <span class="meta">${n.pin? 'ðŸ“Œ Pinned' : ''}</span>
          ${link? `<a class="linkbtn" href="${link}" ${/^https?:\/\//i.test(link)?'target="_blank" rel="noopener"':''}>Open â†’</a>`:''}
        </div>
      </article>
    `;
  }

  function groupByYear(list){
    const map = new Map();
    list.forEach(n=>{
      const y = (n.date||'').slice(0,4) || 'Unknown';
      if(!map.has(y)) map.set(y, []);
      map.get(y).push(n);
    });
    // sort numeric year desc, unknown last
    const arr = Array.from(map.entries());
    const withYearNum = arr.map(([y,items])=>({y, num: /^\d{4}$/.test(y)? parseInt(y,10): -Infinity, items}));
    withYearNum.sort((a,b)=> (b.num - a.num));
    return withYearNum.map(x=>[x.y,x.items]);
  }

  function applyFilter(){
    let list = raw.slice();
    if(activeCat!=='all'){ list = list.filter(n => String(n.category||'').toLowerCase()===activeCat); }
    if(activeTag){ list = list.filter(n => Array.isArray(n.tags) && n.tags.map(t=>t.toLowerCase()).includes(activeTag)); }
    // sort by date desc
    list.sort((a,b)=> parseDate(b.date) - parseDate(a.date));
    return list;
  }

  function render(){
    const filtered = applyFilter();
    const pinned = filtered.filter(n=>n.pin===true);
    const rest = filtered.filter(n=>!n.pin);

    // pinned
    if(pinned.length){
      pinnedSection.style.display = '';
      pinnedGrid.innerHTML = pinned.map(card).join('');
    }else{
      pinnedSection.style.display = 'none';
      pinnedGrid.innerHTML = '';
    }

    // year timeline
    if(rest.length===0){
      container.innerHTML = '';
      document.getElementById('empty').style.display='';
      count.textContent = '0 items';
      return;
    }
    document.getElementById('empty').style.display='none';

    const groups = groupByYear(rest);
    container.innerHTML = groups.map(([yr,items])=>{
      return `<h2 class="section-title">${yr}</h2>
              <div class="grid">
                ${items.map(card).join('')}
              </div>`;
    }).join('');

    count.textContent = `${filtered.length} item${filtered.length>1?'s':''}`;
  }

  // init
  render();
})();
</script>
</body>
</html>
